var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},map;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.checkIsOnRoad=function(t){return!0},Object.defineProperty(i.prototype,"foodPoint",{get:function(){return new egret.Point(t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"info",{get:function(){return this._info},set:function(e){this._info=e,this.x=e.xIndex*t.GridConst.GRId_SIZE,this.y=e.yIndex*t.GridConst.GRId_SIZE,this.setGridSkin();var i=this.getGridColor();if(null!=this.info.prevNode&&null!=this.info.nextNode&&this.info.prevNode.type==t.GridType.EMPTY&&this.info.nextNode.type==t.GridType.EMPTY)this.info.isShowArrow=!0,this.graphics.clear(),this.graphics.beginFill(i),this.graphics.drawCircle(t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2),this.graphics.endFill();else if(null!=this.info.nextNode&&this.info.nextNode.type==t.GridType.EMPTY)this.info.isShowArrow=!0,this.graphics.clear(),this.graphics.beginFill(i),this.graphics.drawCircle(t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2),this.info.dir==player.Direction.TOP?this.graphics.drawRect(0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2):this.info.dir==player.Direction.BOTTOM?this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2):this.info.dir==player.Direction.LEFT?this.graphics.drawRect(t.GridConst.GRId_SIZE/2,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE):this.info.dir==player.Direction.RIGHT&&this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE),this.graphics.endFill();else if(null!=this.info.prevNode&&this.info.prevNode.type==t.GridType.EMPTY){this.info.isShowArrow=!0,this.graphics.clear(),this.graphics.beginFill(i),this.graphics.drawCircle(t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2);var r=this.info.nextNode.dir;r==player.Direction.TOP?this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2):r==player.Direction.BOTTOM?this.graphics.drawRect(0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2):r==player.Direction.LEFT?this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE):r==player.Direction.RIGHT&&this.graphics.drawRect(t.GridConst.GRId_SIZE/2,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE),this.graphics.endFill()}else null!=this.info.nextNode&&this.info.nextNode.dir!=this.info.dir&&(this.graphics.clear(),this.graphics.beginFill(i),this.graphics.drawRoundRect(0,0,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/4,t.GridConst.GRId_SIZE/4),this.info.nextNode.xIndex==this.info.xIndex?this.info.dir==player.Direction.LEFT?(this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2),this.graphics.drawRect(t.GridConst.GRId_SIZE/2,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE)):(this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2),this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE)):this.info.nextNode.yIndex==this.info.yIndex&&(this.info.nextNode.dir==player.Direction.LEFT?(this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE),this.graphics.drawRect(0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2)):(this.graphics.drawRect(t.GridConst.GRId_SIZE/2,0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE),this.graphics.drawRect(0,t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE/2))),this.graphics.endFill());if(this.info.isShowArrow){var n=utils.DisplayObjectUtil.createBitmapByName("arrow_"+e.nextNode.dir+"_png");this.addChild(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"prevGrid",{get:function(){return this._prevGrid},set:function(t){this._prevGrid=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextGrid",{get:function(){return this._nextGrid},set:function(t){this._nextGrid=t},enumerable:!0,configurable:!0}),i.prototype.setGridSkin=function(){var e=this.getGridColor();this.graphics.beginFill(e),this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE),this.graphics.endFill()},i.prototype.getGridColor=function(){var t=16777215;return 2==this._info.mapLevel?t=16776960:3==this._info.mapLevel?t=16711680:4==this._info.mapLevel&&(t=16711935),t},i.prototype.isOnGrid=function(t){return!0},i}(egret.Sprite);t.BaseGrid=e,__reflect(e.prototype,"map.BaseGrid")}(map||(map={}));var Camera=function(){function t(){}return t.setup=function(t){this._map=t},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.follow=function(t){null!=t&&(null!=this.target&&this.target.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.target=t,this.target.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this))},t.onEnterFrame=function(){return null==this._map?void console.error("map is null"):(this._map.x=StageManager.stageWidth/2-this.target.x,void(this._map.y=StageManager.stageHeight/2-this.target.y))},t}();__reflect(Camera.prototype,"Camera");var Main=function(t){function e(){var i=t.call(this)||this;return i.runTime=0,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),e.instance=i,i}return __extends(e,t),e.prototype.onAddToStage=function(t){StageManager.setup(this.stage),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this.stage.stageWidth/640,e=this.stage.stageHeight/1136,i=Math.min(t,e);this.container=new egret.Sprite,this.container.width=640,this.container.height=1136,this.container.scaleX=this.container.scaleY=i,this.stage.addChild(this.container),this.container.anchorOffsetX=320,this.container.anchorOffsetY=568,this.container.x=this.stage.stageWidth/2,this.container.y=this.stage.stageHeight/2,this.gameScene=new ui.GameScene,this.container.addChild(this.gameScene),this.mainMenu=new ui.MainMenu,this.container.addChild(this.mainMenu),RES.getResAsync("description_json",this.startAnimation,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnter,this)},e.prototype.onEnter=function(){this.gameScene.update(egret.getTimer()-this.runTime),this.runTime=egret.getTimer()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){},e.prototype.startGame=function(){egret.Tween.get(this.mainMenu).to({alpha:0},200).call(this.runGameScene,this)},e.prototype.runGameScene=function(){utils.DisplayObjectUtil.removeFromParent(this.mainMenu),this.gameScene.start()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var StageManager=function(){function t(){}return t.setup=function(t){this._stage=t},Object.defineProperty(t,"stageWidth",{get:function(){return this._stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"stageHeight",{get:function(){return this._stage.stageHeight},enumerable:!0,configurable:!0}),t}();__reflect(StageManager.prototype,"StageManager");var tui;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i._bmp=e,i.touchEnabled=!0,i._bmp.anchorOffsetX=i._bmp.width/2,i._bmp.anchorOffsetY=i._bmp.height/2,i.addChild(i._bmp),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i.pressHandler,i),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,i.upHandler,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.clickHandler,i),i}return __extends(e,t),e.prototype.pressHandler=function(t){egret.Tween.get(this._bmp).to({scaleX:.9,scaleY:.9},100),null!=this._pressFun&&this._pressFun()},e.prototype.clickHandler=function(t){egret.Tween.get(this._bmp).to({scaleX:1,scaleY:1},100),null!=this._clickFun&&this._clickFun()},e.prototype.upHandler=function(t){egret.Tween.get(this._bmp).to({scaleX:1,scaleY:1},100)},e.prototype.dispose=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.upHandler,this)},e}(egret.DisplayObjectContainer);t.Button=e,__reflect(e.prototype,"tui.Button")}(tui||(tui={}));var events;!function(t){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(egret.Event);e.RESTART_GAME="restartGame",t.GameEvent=e,__reflect(e.prototype,"events.GameEvent")}(events||(events={}));var map;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.DICT_KEY="level_",t.reset(),t}return __extends(i,e),i.prototype.reset=function(){this.prevContainerPos=new egret.Point,this._mapLevel=1,this.mapContainerDict=new utils.Dictionary,this.mapDict=new utils.Dictionary,this.allGridDict=new utils.Dictionary,null!=this.mapLayer&&this.mapLayer.removeChildren(),null!=this.playerLayer&&this.playerLayer.removeChildren(),this.mapLayer=new egret.Sprite,this.playerLayer=new egret.Sprite,this.addChild(this.mapLayer),this.addChild(this.playerLayer),this.createMap(this.mapLevel);var t=this.mapDict[this.DICT_KEY+this.mapLevel];this.createMap(this._mapLevel+1,t[t.length-1].info)},i.prototype.addPlayer=function(t){t.pos=this.playerStartPoint,this.player=t,this.playerLayer.addChild(t)},Object.defineProperty(i.prototype,"mapLevel",{get:function(){return this._mapLevel},set:function(t){if(t>this._mapLevel){this._mapLevel-1>0&&this.removeOldMap(this._mapLevel-1),this._mapLevel=t;var e=this.mapDict[this.DICT_KEY+this.mapLevel];this.createMap(this._mapLevel+1,e[e.length-1].info)}},enumerable:!0,configurable:!0}),i.prototype.createMap=function(e,i){void 0===i&&(i=null);var r=null,n=new Array;this.mapDict.add(this.DICT_KEY+e,n);var s=new egret.DisplayObjectContainer;this.mapContainerDict.add(this.DICT_KEY+e,s),s.x=this.prevContainerPos.x,s.y=this.prevContainerPos.y;for(var a=t.MapFactory.createMapData(e,i),o=0;o<a.length;o++){var i=a[o],h=t.MapFactory.getGridByType(i.type);h.info=i,h.prevGrid=r,null!=r&&(r.nextGrid=h),r=h,0==o&&1==e&&(this.playerStartPoint=new egret.Point(h.x+i.centerPoint.x,h.y+i.centerPoint.y)),s.addChild(h),h.x=h.x-this.prevContainerPos.x,h.y=h.y-this.prevContainerPos.y,n.push(h),this.allGridDict.add(i.xIndex+"_"+i.yIndex,h),o==a.length-1&&(this.prevContainerPos=new egret.Point(h.x,h.y))}this.mapLayer.addChild(s),s.cacheAsBitmap=!0},i.prototype.isOnMap=function(t,e){return null!=this.getCurrentGrid(t,e)},i.prototype.getCurrentGrid=function(e,i){var r=Math.floor(e/t.GridConst.GRId_SIZE),n=Math.floor(i/t.GridConst.GRId_SIZE),s=this.allGridDict;if(0==s.containsKey(r+"_"+n))return null;var a=s[r+"_"+n];return a},i.prototype.getPlayerGrid=function(){var t=this.player.x,e=this.player.y;return this.getCurrentGrid(t,e)},i.prototype.touchHandler=function(){var t=this.getPlayerGrid();if(null!=t){var e=this.getNextMoveDir(t);e==this.player.direction?this.player.jump():this.player.direction=e}},i.prototype.getNextMoveDir=function(e){var i=0,r=e.nextGrid;if(null==r)return this.player.direction;if(r.info.type==t.GridType.EMPTY)return this.player.direction;for(;3>i&&r.info.dir==this.player.direction;){if(i++,r=r.nextGrid,null==r)return this.player.direction;if(r.info.type==t.GridType.EMPTY)return this.player.direction}return r.info.dir},i.prototype.removeOldMap=function(t){var e=this.mapContainerDict[this.DICT_KEY+t];utils.DisplayObjectUtil.removeFromParent(e);var i=this.mapDict[this.DICT_KEY+t];i=null,this.mapDict.remove(this.DICT_KEY+t)},i}(egret.Sprite);t.Map=e,__reflect(e.prototype,"map.Map")}(map||(map={}));var map;!function(t){var e=function(){function t(){}return t.getMapLength=function(t){return 100},t.getBendingRank=function(t){if(1==t){var e=this.MAX-1;return e>5&&(e=5),e}var e=this.MAX-10;return 0>=e&&(e=1),3},t.getSeparateRank=function(t){if(1==t){var e=this.MAX-1;return e}var e=this.MAX-10;return 0>=e&&(e=1),3},t}();e.MAX=10,t.MapConfig=e,__reflect(e.prototype,"map.MapConfig")}(map||(map={}));var map;!function(t){var e=function(){function e(){}return e.createMapData=function(e,i){void 0===i&&(i=null),this.MAX=t.MapConfig.getMapLength(e),this.count=0,null==i?this.prevNode=new t.MapNode:this.prevNode=i,this.list=new Array,null==i&&this.list.push(this.prevNode),this.bendingRank=t.MapConfig.getBendingRank(e),this.separateRank=t.MapConfig.getSeparateRank(e),this.create(e);var r=this.list[0];return r.type=t.GridType.FIRST,this.list},e.create=function(e){var i;if(this.count<5||this.count>this.MAX-5)i=this.createNode(player.Direction.TOP);else{var r=[];if(this.prevNode.dir==player.Direction.TOP?r.push(player.Direction.LEFT,player.Direction.RIGHT,player.Direction.TOP):this.prevNode.dir==player.Direction.LEFT?r.push(player.Direction.LEFT,player.Direction.TOP):this.prevNode.dir==player.Direction.RIGHT&&r.push(player.Direction.RIGHT,player.Direction.TOP),this.count%this.bendingRank==0){var n=Math.floor(Math.random()*r.length);i=this.createNode(r[n])}else i=this.createNode(this.prevNode.dir);this.count%this.separateRank==0&&null!=i.prevNode.prevNode&&i.prevNode.dir==i.dir&&i.prevNode.prevNode.dir==i.dir&&i.prevNode.prevNode.type!=t.GridType.EMPTY&&(i.prevNode.type=t.GridType.EMPTY)}i.mapLevel=e,this.prevNode=i,this.list.push(i),this.count++,this.count<this.MAX&&this.create(e)},e.createNode=function(e){var i=new t.MapNode;switch(e){case player.Direction.TOP:i.xIndex=this.prevNode.xIndex,i.yIndex=this.prevNode.yIndex-1,i.dir=player.Direction.TOP;break;case player.Direction.LEFT:i.xIndex=this.prevNode.xIndex-1,i.yIndex=this.prevNode.yIndex,i.dir=player.Direction.LEFT;break;case player.Direction.RIGHT:i.xIndex=this.prevNode.xIndex+1,i.yIndex=this.prevNode.yIndex,i.dir=player.Direction.RIGHT;break;default:i.xIndex=this.prevNode.xIndex,i.yIndex=this.prevNode.yIndex-1,i.dir=player.Direction.TOP}return i.prevNode=this.prevNode,this.prevNode.nextNode=i,i.dir!=this.prevNode.dir&&(this.prevNode.isShowArrow=!0),i},e.getGridByType=function(e){var i;switch(e){case t.GridType.NORMAL:i=new t.BaseGrid;break;case t.GridType.EMPTY:i=new t.EmptyGrid;break;case t.GridType.FIRST:i=new t.FirstGrid;break;default:i=new t.BaseGrid}return i},e}();e.MAX=100,t.MapFactory=e,__reflect(e.prototype,"map.MapFactory")}(map||(map={}));var map;!function(t){var e=function(){function e(){this.xIndex=0,this.yIndex=0,this.dir=player.Direction.TOP,this._isShowArrow=!1,this.mapLevel=0,this.type=t.GridType.NORMAL}return Object.defineProperty(e.prototype,"centerPoint",{get:function(){return new egret.Point(t.GridConst.GRId_SIZE/2,t.GridConst.GRId_SIZE/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isShowArrow",{get:function(){return this._isShowArrow},set:function(t){this._isShowArrow=t},enumerable:!0,configurable:!0}),e}();t.MapNode=e,__reflect(e.prototype,"map.MapNode")}(map||(map={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var map;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setGridSkin=function(){var e=this.getGridColor();this.graphics.beginFill(e,0),this.graphics.drawRect(0,0,t.GridConst.GRId_SIZE,t.GridConst.GRId_SIZE),this.graphics.endFill()},i.prototype.isOnGrid=function(t){return!1},i}(t.BaseGrid);t.EmptyGrid=e,__reflect(e.prototype,"map.EmptyGrid")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(t.BaseGrid);t.FirstGrid=e,__reflect(e.prototype,"map.FirstGrid")}(map||(map={}));var map;!function(t){var e=function(){function t(){}return t}();e.GRId_SIZE=64,t.GridConst=e,__reflect(e.prototype,"map.GridConst");var i=function(){function t(){}return t}();i.NORMAL=0,i.EMPTY=1,i.HALF=2,i.FIRST=3,t.GridType=i,__reflect(i.prototype,"map.GridType")}(map||(map={}));var player;!function(t){var e;!function(t){t[t.LEFT=0]="LEFT",t[t.TOP=1]="TOP",t[t.RIGHT=2]="RIGHT",t[t.BOTTOM=3]="BOTTOM"}(e=t.Direction||(t.Direction={}))}(player||(player={}));var player;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.SKIN_NAME="player_skin_",i._skinID=0,i._speed=0,i._isJump=!1,i.skinID=0,i.speed=4,i.direction=t.Direction.TOP,i.deadIcon=utils.DisplayObjectUtil.createBitmapByName("dead_icon_png"),i.deadIcon.anchorOffsetX=i.deadIcon.width/2,i.deadIcon.anchorOffsetY=i.deadIcon.height/2,i.deadIcon.x=0,i.deadIcon.y=0,i.cacheAsBitmap=!0,i}return __extends(i,e),Object.defineProperty(i.prototype,"skinID",{get:function(){return this._skinID},set:function(t){this._skinID=t,this._playerImg=utils.DisplayObjectUtil.createBitmapByName(this.SKIN_NAME+this.skinID+"_png"),this.addChild(this._playerImg),this._playerImg.anchorOffsetX=this._playerImg.width/2,this._playerImg.anchorOffsetY=this._playerImg.height/2,this._playerImg.x=0,this._playerImg.y=0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pos",{set:function(t){this.x=t.x,this.y=t.y},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this._dir},set:function(e){this._dir=e,e==t.Direction.LEFT?(this._xPower=-1,this._yPower=0,this._playerImg.rotation=-90):e==t.Direction.TOP?(this._xPower=0,this._yPower=-1,this._playerImg.rotation=0):e==t.Direction.RIGHT?(this._xPower=1,this._yPower=0,this._playerImg.rotation=90):e==t.Direction.BOTTOM&&(this._xPower=0,this._yPower=1,this._playerImg.rotation=180)},enumerable:!0,configurable:!0}),i.prototype.jump=function(){this._isJump=!0;var t=300;egret.Tween.get(this).to({scaleX:1.2,scaleY:1.2},t).to({scaleX:1,scaleY:1},t).call(this.jumpOver,this)},i.prototype.jumpOver=function(){this._isJump=!1},Object.defineProperty(i.prototype,"isUndead",{get:function(){return this._isJump},enumerable:!0,configurable:!0}),i.prototype.move=function(t){this.x+=this._xPower*this.speed,this.y+=this._yPower*this.speed},i.prototype.dead=function(){this.deadIcon.scaleX=0,this.deadIcon.scaleY=0,this.addChild(this.deadIcon),egret.Tween.get(this._playerImg).to({scaleX:0,scaleY:0},200),egret.Tween.get(this.deadIcon).to({scaleX:1,scaleY:1},200)},i.prototype.reset=function(){this.x=0,this.y=0,utils.DisplayObjectUtil.removeFromParent(this.deadIcon),this._playerImg.scaleX=1,this._playerImg.scaleY=1,this.direction=t.Direction.TOP},i}(egret.DisplayObjectContainer);t.Player=e,__reflect(e.prototype,"player.Player")}(player||(player={}));var ui;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.isStart=!1,i.isDead=!1,i.bmpStrings=["num_3_png","num_2_png","num_1_png","go_png"],i.graphics.beginFill(52479),i.graphics.drawRect(0,0,StageManager.stageWidth,StageManager.stageHeight),i.graphics.endFill(),i._map=new map.Map,i.addChild(i._map),i.player=new player.Player,i._map.addPlayer(i.player),Camera.setup(i._map),Camera.follow(i.player),i.timer=new egret.Timer(1e3,5),i.numBmp=new egret.Bitmap,i.touchSprite=new egret.Shape,i.touchSprite.graphics.beginFill(0,.4),i.touchSprite.graphics.drawRect(0,0,StageManager.stageWidth,StageManager.stageHeight),i.touchSprite.graphics.endFill(),i.touchSprite.cacheAsBitmap=!0,i.addChild(i.touchSprite),i.resultPanel=new t.ResultPanel,utils.DisplayObjectUtil.centerObjToStage(i.resultPanel),i.orResultPanelY=i.resultPanel.y,i.addEvent(),i}return __extends(i,e),i.prototype.addEvent=function(){this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.touchSprite.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchHandler,this),this.resultPanel.addEventListener(events.GameEvent.RESTART_GAME,this.restartGame,this)},i.prototype.touchHandler=function(t){0!=this.isStart&&1!=this.isDead&&this._map.touchHandler()},i.prototype.update=function(t){if(0!=this.isStart&&1!=this.isDead){var e=this._map.getPlayerGrid();if(this.player.direction=e.info.nextNode.dir,null==e){if(0==this.player.isUndead)return console.warn("dead!"),void this.end()}else this._map.mapLevel=e.info.mapLevel;this.player.move(t)}},i.prototype.start=function(){this.timer.start(),this.isDead=!1},i.prototype.end=function(){this.isStart=!1,this.timer.reset(),this.touchSprite.touchEnabled=!1,this.player.dead(),this.isDead=!0,this.showResultPanel()},i.prototype.onTimer=function(t){utils.DisplayObjectUtil.removeFromParent(this.numBmp);var e=this.timer.currentCount;5==e||(4==e&&(this.hideMask(),this.touchSprite.touchEnabled=!0,this.isStart=!0),this.numBmp=utils.DisplayObjectUtil.createBitmapByName(this.bmpStrings[e-1]),this.numBmp.alpha=0,utils.DisplayObjectUtil.centerObjToStage(this.numBmp),this.numBmp.y=(StageManager.stageHeight-this.numBmp.height)/2+2.5*this.numBmp.height,egret.Tween.get(this.numBmp).to({alpha:1,y:(StageManager.stageHeight-this.numBmp.height)/2+2.5*this.numBmp.height-100},200,egret.Ease.backOut),this.addChild(this.numBmp))},i.prototype.showMask=function(){this.touchSprite.alpha=1},i.prototype.hideMask=function(){this.touchSprite.alpha=0},i.prototype.showResultPanel=function(){var t=this;setTimeout(function(){t.showMask();var e=StageManager.stageHeight;t.resultPanel.y=e,t.addChild(t.resultPanel),egret.Tween.get(t.resultPanel).to({y:t.orResultPanelY},400,egret.Ease.backOut)},600)},i.prototype.hideResultPanel=function(){egret.Tween.get(this.resultPanel).to({y:StageManager.stageHeight},400,egret.Ease.backIn)},i.prototype.restartGame=function(t){this.hideResultPanel(),this._map.reset(),this.player.reset(),this._map.addPlayer(this.player),this.start()},i}(egret.Sprite);t.GameScene=e,__reflect(e.prototype,"ui.GameScene")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this,i=utils.DisplayObjectUtil.createBitmapByName("main_menu_bg_png");e.addChild(i);var r=new tui.Button(utils.DisplayObjectUtil.createBitmapByName("main_menu_start_btn_png"));return e.addChild(r),r.x=i.width/2,r.y=i.height-450,r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,e.startHandler,e),e}return __extends(e,t),e.prototype.startHandler=function(t){Main.instance.startGame()},e}(egret.Sprite);t.MainMenu=e,__reflect(e.prototype,"ui.MainMenu")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;e.bg=utils.DisplayObjectUtil.createBitmapByName("result_panel_bg_png"),e.addChild(e.bg),e.width=e.bg.width,e.height=e.bg.height,e.scoreBg=utils.DisplayObjectUtil.createBitmapByName("result_panel_score_bg_png"),utils.DisplayObjectUtil.centerObj(e.scoreBg,e),e.scoreBg.y=100,e.addChild(e.scoreBg),e.starIcon=utils.DisplayObjectUtil.createBitmapByName("result_panel_gold_icon_png"),e.starIcon.x=e.scoreBg.x+e.scoreBg.width-e.starIcon.width-20,e.starIcon.y=e.scoreBg.y-1,e.addChild(e.starIcon),e.shareIcon=new tui.Button(utils.DisplayObjectUtil.createBitmapByName("share_icon_png")),e.homeIcon=new tui.Button(utils.DisplayObjectUtil.createBitmapByName("home_icon_png")),e.shopIcon=new tui.Button(utils.DisplayObjectUtil.createBitmapByName("shop_icon_png"));for(var i=[e.shareIcon,e.homeIcon,e.shopIcon],r=95,n=e.shareIcon.width+e.homeIcon.width+e.shopIcon.width+190,s=(e.width-n)/2+e.shareIcon.width/2,a=0;a<i.length;a++){var o=i[a];o.x=s+(o.width+r)*a,o.y=e.height-90,e.addChild(o)}return e.restartBtn=new tui.Button(utils.DisplayObjectUtil.createBitmapByName("result_panel_restart_btn_png")),e.restartBtn.x=e.width/2,e.restartBtn.y=e.height/2+30,e.addChild(e.restartBtn),e.cacheAsBitmap=!0,e.addEvent(),e}return __extends(e,t),e.prototype.addEvent=function(){this.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this)},e.prototype.restartGame=function(t){this.dispatchEvent(new events.GameEvent(events.GameEvent.RESTART_GAME))},e}(egret.DisplayObjectContainer);t.ResultPanel=e,__reflect(e.prototype,"ui.ResultPanel")}(ui||(ui={}));var utils;!function(t){var e=function(){function t(){this._keys=new Array,this._values=new Array}return t.prototype.add=function(t,e){this[t]=e,this._keys.push(t),this._values.push(e)},t.prototype.remove=function(t){var e=this._keys.indexOf(t,0);this._keys.splice(e,1),this._values.splice(e,1),delete this[t]},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t.prototype.containsKey=function(t){return"undefined"==typeof this[t]?!1:!0},t}();t.Dictionary=e,__reflect(e.prototype,"utils.Dictionary")}(utils||(utils={}));var utils;!function(t){var e=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.removeFromParent=function(t){null!=t&&null!=t.parent&&t.parent.removeChild(t)},t.centerObjToStage=function(t){null!=t&&(t.x=(StageManager.stageWidth-t.width)/2,t.y=(StageManager.stageHeight-t.height)/2)},t.centerObj=function(t,e){null!=t&&null!=e&&(t.x=(e.width-t.width)/2,t.y=(e.height-t.height)/2)},t}();t.DisplayObjectUtil=e,__reflect(e.prototype,"utils.DisplayObjectUtil")}(utils||(utils={}));